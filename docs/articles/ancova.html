<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ANOVA and ANCOVA Boundaries • RCTCovarAdjust</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/sandstone/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="ANOVA and ANCOVA Boundaries">
<meta property="og:description" content="RCTCovarAdjust">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RCTCovarAdjust</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ancova.html">ANOVA and ANCOVA Boundaries</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ancova_files/header-attrs-2.3/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>ANOVA and ANCOVA Boundaries</h1>
            
      
      
      <div class="hidden name"><code>ancova.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">RCTCovarAdjust</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span></code></pre></div>
<div id="data-generating-process" class="section level2">
<h2 class="hasAnchor">
<a href="#data-generating-process" class="anchor"></a>Data Generating Process</h2>
<p>To use the boundary functions, including <code>get.boundaries</code> and <code>get.boundaries.aspend</code>, we need to define both a data generating process under the null hypothesis and a test statistic function. The test statistic function may be <em>different</em> across stages, e.g. if ANOVA is performed at each stage until the last stage when ANCOVA is performed.</p>
<p>Here we create a general data generating function that simulates two-arm trial data according to:</p>
<p><span class="math display">\[
y_i = \beta_0 + t_i \Delta + z_i \gamma + \epsilon_i
\]</span></p>
<p><span class="math display">\[
t_i \sim Bernoulli(0.5), \quad z_i \sim Normal(0, \theta), \quad \epsilon_i \sim Normal(0, \sigma^2)
\]</span> where <span class="math inline">\(y_i\)</span> is a continuous outcome, <span class="math inline">\(t_i\)</span> is the treatment effect, <span class="math inline">\(z_i\)</span> is the covariate, and <span class="math inline">\(\epsilon_i\)</span> is random error. Note that if we set <span class="math inline">\(\gamma = 0\)</span>, then there is no covariate effect.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">data.generator</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">delta</span>, <span class="va">gamma</span>, <span class="va">theta</span>, <span class="va">sigma2</span>, <span class="va">b0</span><span class="op">)</span><span class="op">{</span>
  <span class="co"># intercept</span>
  <span class="va">int</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span><span class="op">)</span>
  <span class="co"># covariate</span>
  <span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="va">theta</span><span class="op">)</span>
  <span class="co"># treatment indicator</span>
  <span class="va">t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html">rbinom</a></span><span class="op">(</span><span class="va">n</span>, size<span class="op">=</span><span class="fl">1</span>, prob<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html">ifelse</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>
  <span class="co"># noise</span>
  <span class="va">e</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="va">n</span>, <span class="fl">0</span>, <span class="va">sigma2</span><span class="op">**</span><span class="fl">0.5</span><span class="op">)</span>
  
  <span class="co"># outcome</span>
  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">int</span> <span class="op">*</span> <span class="va">b0</span> <span class="op">+</span> <span class="va">t</span> <span class="op">*</span> <span class="va">delta</span> <span class="op">+</span> <span class="va">z</span> <span class="op">*</span> <span class="va">gamma</span> <span class="op">+</span> <span class="va">e</span> <span class="op">%&gt;%</span> <span class="va">matrix</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"y"</span>

  <span class="co"># design matrix</span>
  <span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">t</span>, <span class="va">int</span>, <span class="va">z</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span><span class="op">)</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>What does one simulation look like?</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">data.generator</span><span class="op">(</span><span class="fl">10</span>, delta<span class="op">=</span><span class="fl">0</span>, gamma<span class="op">=</span><span class="fl">1</span>, theta<span class="op">=</span><span class="fl">1</span>, sigma2<span class="op">=</span><span class="fl">1</span>, b0<span class="op">=</span><span class="fl">0</span><span class="op">)</span>
<span class="co">#&gt;                y  t int          z</span>
<span class="co">#&gt;  [1,] -1.3037263 -1   1 -1.3629136</span>
<span class="co">#&gt;  [2,] -1.3229655  1   1 -0.9439810</span>
<span class="co">#&gt;  [3,]  0.3083768  1   1  1.7839715</span>
<span class="co">#&gt;  [4,]  2.1626875 -1   1  0.4626526</span>
<span class="co">#&gt;  [5,] -0.4989122  1   1 -0.8982220</span>
<span class="co">#&gt;  [6,]  0.5681539  1   1 -0.3422980</span>
<span class="co">#&gt;  [7,]  0.7382713  1   1 -0.4242459</span>
<span class="co">#&gt;  [8,] -1.8976486 -1   1 -0.1166130</span>
<span class="co">#&gt;  [9,]  0.4482977 -1   1  0.8154712</span>
<span class="co">#&gt; [10,]  1.3490128  1   1  0.5939789</span></code></pre></div>
<p>Now let’s customize this data generating function slightly for the examples that we’ll be using by fixing some <span class="math inline">\(\gamma\)</span>, <span class="math inline">\(\theta\)</span>, and <span class="math inline">\(\sigma^2\)</span>, and having <span class="math inline">\(\Delta = 0\)</span> be the null value.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">null.generator</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="fu">data.generator</span><span class="op">(</span>n<span class="op">=</span><span class="va">n</span>, delta<span class="op">=</span><span class="fl">0</span>, gamma<span class="op">=</span><span class="fl">1</span>,
                                             theta<span class="op">=</span><span class="fl">1</span>, sigma2<span class="op">=</span><span class="fl">1</span>, b0<span class="op">=</span><span class="fl">0</span><span class="op">)</span></code></pre></div>
</div>
<div id="test-statistic" class="section level2">
<h2 class="hasAnchor">
<a href="#test-statistic" class="anchor"></a>Test Statistic</h2>
<p>Now we need to create functions to fit ANOVA or ANCOVA and return test statistics for each. The idea behind the boundary functions is that as long as your data generator and your test statistic functions are compatible with one another, i.e. the test statistic function takes in the output of the data generator, and that the output of the data generator is a matrix, then the boundary function will work.</p>
<p>Below is a general function which can be used for either ANOVA or ANCOVA, since it just fits a linear regression model to estimate <span class="math inline">\(\Delta\)</span>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fit.regression</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">out.col</span>, <span class="va">t.col</span>, <span class="va">var.cols</span><span class="op">)</span><span class="op">{</span>
  
  <span class="co"># Get dimensions of problem</span>
  <span class="va">n</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>
  <span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">var.cols</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span> <span class="co"># plus one for treatment col</span>
  
  <span class="co"># Get the outcome and design matrix</span>
  <span class="co"># Design matrix is based on what is included in var.cols</span>
  <span class="co"># If the covariate is in in var.cols, then it's ANCOVA otherwise it's ANOVA</span>
  <span class="va">y</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="va">out.col</span><span class="op">]</span>
  <span class="va">X</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">t.col</span>, <span class="va">var.cols</span><span class="op">)</span><span class="op">]</span>
  
  <span class="co"># Get the estimates</span>
  <span class="va">esti</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html">solve</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">%*%</span> <span class="va">X</span><span class="op">)</span> <span class="op">%*%</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">%*%</span> <span class="va">y</span>
  
  <span class="co"># Calculate residual variance</span>
  <span class="va">residu</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">-</span> <span class="va">X</span> <span class="op">%*%</span> <span class="va">esti</span>
  
  <span class="co"># When we want to estimate the residual variance, this is what we'll do</span>
  <span class="co"># but then we would need to use bounds for t-distribution</span>
  <span class="va">shat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">residu</span><span class="op">**</span><span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">n</span> <span class="op">-</span> <span class="va">p</span><span class="op">)</span>
  
  <span class="co"># \Delta estimate</span>
  <span class="va">delta</span> <span class="op">&lt;-</span> <span class="va">esti</span><span class="op">[</span><span class="va">t.col</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span>
  
  <span class="co"># Compute standardized test statistic</span>
  <span class="va">tstat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">*</span> <span class="va">delta</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">shat</span><span class="op">)</span>
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">tstat</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Now we will customize this function for ANOVA and ANCOVA:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">t.anova</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="fu">fit.regression</span><span class="op">(</span>data<span class="op">=</span><span class="va">data</span>, out.col<span class="op">=</span><span class="fl">1</span>,
                                         t.col<span class="op">=</span><span class="fl">2</span>, var.cols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span><span class="op">)</span>
<span class="va">t.ancova</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="fu">fit.regression</span><span class="op">(</span>data<span class="op">=</span><span class="va">data</span>, out.col<span class="op">=</span><span class="fl">1</span>,
                                          t.col<span class="op">=</span><span class="fl">2</span>, var.cols<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="group-sequential-boundaries" class="section level2">
<h2 class="hasAnchor">
<a href="#group-sequential-boundaries" class="anchor"></a>Group Sequential Boundaries</h2>
<p>At this point, we have defined the data generating mechanism, and the test statistic functions. We can consider what the group sequential boundaries would look like for different trial parameters.</p>
<div id="constant-boundaries" class="section level3">
<h3 class="hasAnchor">
<a href="#constant-boundaries" class="anchor"></a>Constant Boundaries</h3>
<p>One option is to consider constant boundaries on whatever scale of the test statistic is being used. For Pocock boundaries, that is the likelihood ratio scale, whereas for O’Brien-Fleming, that is the score statistic scale.</p>
<p>Note that for constant boundaries, we need to assume that the trial sequences have an equal number of participants.</p>
<div id="pocock-boundaries" class="section level4">
<h4 class="hasAnchor">
<a href="#pocock-boundaries" class="anchor"></a>Pocock Boundaries</h4>
<p>To replicate Pocock boundaries, we use the test statistic function that we have already defined. Consider three different options: (1) perform ANOVA at each stage, (2) perform ANCOVA at each stage, or (3) perform ANOVA at all but the last stage. We can define sequences of test statistic functions to simulate this process and see what boundaries preserve a fixed type I error.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">101</span><span class="op">)</span>

<span class="co"># Number of trial stages</span>
<span class="va">K</span> <span class="op">&lt;-</span> <span class="fl">5</span>

<span class="co"># ANOVA</span>
<span class="va">p.t.anova</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">)</span> <span class="va">p.t.anova</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">t.anova</span>

<span class="co"># ANCOVA</span>
<span class="va">p.t.ancova</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">)</span> <span class="va">p.t.ancova</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">t.ancova</span>

<span class="co"># ANOVA-ANCOVA</span>
<span class="va">p.t.mismatch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span><span class="op">)</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="va">K</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="va">p.t.mismatch</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">t.anova</span>
<span class="va">p.t.mismatch</span><span class="op">[[</span><span class="va">K</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">t.ancova</span></code></pre></div>
<p>Now we will use the <code>get.boundaries</code> function with <code>100</code> people enrolled and a type I error of <code>0.05</code>. <code>n_sims</code> controls the accuracy of the Monte Carlo approximation to nested integration. For a 5-stage trial, the corresponding exact Pocock boundary is <code>2.4132</code>. It is the boundary used at every stage.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get.boundaries.html">get.boundaries</a></span><span class="op">(</span>power<span class="op">=</span><span class="fl">0.05</span>, n_sims<span class="op">=</span><span class="fl">1000</span>, K<span class="op">=</span><span class="va">K</span>, n<span class="op">=</span><span class="fl">100</span>,
               stat.func<span class="op">=</span><span class="va">p.t.anova</span>,
               data.generator<span class="op">=</span><span class="va">null.generator</span><span class="op">)</span>
<span class="co">#&gt; [1] 2.405875</span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get.boundaries.html">get.boundaries</a></span><span class="op">(</span>power<span class="op">=</span><span class="fl">0.05</span>, n_sims<span class="op">=</span><span class="fl">1000</span>, K<span class="op">=</span><span class="va">K</span>, n<span class="op">=</span><span class="fl">100</span>,
               stat.func<span class="op">=</span><span class="va">p.t.ancova</span>,
               data.generator<span class="op">=</span><span class="va">null.generator</span><span class="op">)</span>
<span class="co">#&gt; [1] 2.425369</span></code></pre></div>
<p>Now we expect that the sequence of test statistics that represent the mismatch will result in a larger boundary than the ones with homogeneous test statistic functions because there is less correlation between the test statistics over stages.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/get.boundaries.html">get.boundaries</a></span><span class="op">(</span>power<span class="op">=</span><span class="fl">0.05</span>, n_sims<span class="op">=</span><span class="fl">1000</span>, K<span class="op">=</span><span class="va">K</span>, n<span class="op">=</span><span class="fl">100</span>,
               stat.func<span class="op">=</span><span class="va">p.t.mismatch</span>,
               data.generator<span class="op">=</span><span class="va">null.generator</span><span class="op">)</span>
<span class="co">#&gt; [1] 2.527464</span></code></pre></div>
</div>
<div id="obrien-fleming-boundaries" class="section level4">
<h4 class="hasAnchor">
<a href="#obrien-fleming-boundaries" class="anchor"></a>O’Brien-Fleming Boundaries</h4>
<p>To derive O’Brien-Fleming (OBF) boundaries, we need a test statistic that is constant on the score statistic scale. For an equally sized stage trial, the score statistic is equivalent to the sum of the stage-wise test statistics, which we can derive by multiplying the cumulative stage test-statistic by <span class="math inline">\(\sqrt{k}\)</span> where <span class="math inline">\(k\)</span> is the stage.</p>
<p>Therefore, to get the test statistic to use with <code>get.boundaries</code>, we can simply modify the Pocock test statistic functions:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># ANOVA</span>
<span class="va">obf.t.anova</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html">mapply</a></span><span class="op">(</span>FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="fu">x</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">*</span> <span class="va">y</span>, 
                      x<span class="op">=</span><span class="va">p.t.anova</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">)</span><span class="op">)</span>

<span class="co"># ANCOVA</span>
<span class="va">obf.t.ancova</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html">mapply</a></span><span class="op">(</span>FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="fu">x</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">*</span> <span class="va">y</span>, 
                       x<span class="op">=</span><span class="va">p.t.ancova</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">)</span><span class="op">)</span>

<span class="co"># ANOVA-ANCOVA</span>
<span class="va">obf.t.mismatch</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mapply.html">mapply</a></span><span class="op">(</span>FUN<span class="op">=</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="fu">x</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">*</span> <span class="va">y</span>, 
                         x<span class="op">=</span><span class="va">p.t.mismatch</span>, y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Let’s use these in the boundaries function. Note that the result that we get are the boundaries for the test statistics on the score statistic scale. For Pocock boundaries, the boundary that we got was constant for all stages. For OBF boundaries, we can take the constant that we get and then divide it by <span class="math inline">\(\sqrt{k}\)</span> to get the corresponding boundary for the <span class="math inline">\(k^{th}\)</span> stage.</p>
<p>We hope to get a constant value somewhere around <code>4.5617</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">b.anova</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get.boundaries.html">get.boundaries</a></span><span class="op">(</span>power<span class="op">=</span><span class="fl">0.05</span>, n_sims<span class="op">=</span><span class="fl">1000</span>, K<span class="op">=</span><span class="va">K</span>, n<span class="op">=</span><span class="fl">100</span>,
                          stat.func<span class="op">=</span><span class="va">obf.t.anova</span>,
                          data.generator<span class="op">=</span><span class="va">null.generator</span><span class="op">)</span>
<span class="va">b.anova</span>
<span class="co">#&gt; [1] 4.547572</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">b.anova</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">)</span>
<span class="co">#&gt; [1] 4.547572 3.215619 2.625542 2.273786 2.033736</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">b.ancova</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get.boundaries.html">get.boundaries</a></span><span class="op">(</span>power<span class="op">=</span><span class="fl">0.05</span>, n_sims<span class="op">=</span><span class="fl">1000</span>, K<span class="op">=</span><span class="va">K</span>, n<span class="op">=</span><span class="fl">100</span>,
                           stat.func<span class="op">=</span><span class="va">obf.t.ancova</span>,
                           data.generator<span class="op">=</span><span class="va">null.generator</span><span class="op">)</span>
<span class="va">b.ancova</span>
<span class="co">#&gt; [1] 4.603488</span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">b.ancova</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">)</span>
<span class="co">#&gt; [1] 4.603488 3.255158 2.657825 2.301744 2.058743</span></code></pre></div>
<p>Again, we expect that the sequence of test statistics that represent the mismatch will result in a larger boundary:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">b.mismatch</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get.boundaries.html">get.boundaries</a></span><span class="op">(</span>power<span class="op">=</span><span class="fl">0.05</span>, n_sims<span class="op">=</span><span class="fl">1000</span>, K<span class="op">=</span><span class="va">K</span>, n<span class="op">=</span><span class="fl">100</span>,
                             stat.func<span class="op">=</span><span class="va">obf.t.mismatch</span>,
                             data.generator<span class="op">=</span><span class="va">null.generator</span><span class="op">)</span>
<span class="va">b.mismatch</span>
<span class="co">#&gt; [1] 4.68874</span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">b.mismatch</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">K</span><span class="op">)</span>
<span class="co">#&gt; [1] 4.688740 3.315440 2.707045 2.344370 2.096868</span></code></pre></div>
</div>
</div>
<div id="alpha-spending" class="section level3">
<h3 class="hasAnchor">
<a href="#alpha-spending" class="anchor"></a>Alpha-Spending</h3>
<p>We may have a situation where we don’t have equally sized stages, or want to use up the type I error in a way that is not consistent with Pocock or OBF boundaries. In this case, we can use <span class="math inline">\(\alpha\)</span>-spending functions.</p>
<p>We have an equivalent function to <code>get.boundaries</code> called <code>get.boundaries.aspend</code>, which has a few key differences. It takes the same information about a <code>stat.func</code> and a <code>data.generator</code>, but it now needs a maximum sample size <code>N</code> and information rates <code>rates</code> (the proportion of total sample size seen at each look). Additionally, we need to specify both a type I error (<code>a</code>) and a function to <em>spend</em> that type I error, <code>a.func</code>, over each of the stages.</p>
<p>The <code>a.func</code> or <span class="math inline">\(\alpha^*\)</span> must be monotonically increasing function, with <span class="math inline">\(\alpha^*(0) = 0\)</span> and <span class="math inline">\(\alpha^*(1) = \alpha\)</span>.</p>
<div id="approximation-to-pocock-boundaries" class="section level4">
<h4 class="hasAnchor">
<a href="#approximation-to-pocock-boundaries" class="anchor"></a>Approximation to Pocock Boundaries</h4>
<p>The <span class="math inline">\(\alpha\)</span>-spending function that is an approximation to Pocock boundaries is <span class="math display">\[
\alpha^*(t) = \alpha \log(1 + t(\exp(1) - 1))
\]</span></p>
<p>Let’s define this function and see if we get something around <code>2.4132</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># the alpha-spending function</span>
<span class="va">a.func.pocock</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">t</span><span class="op">)</span> <span class="va">a</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html">log</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html">exp</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">t</span><span class="op">)</span>

<span class="co"># observed information rates</span>
<span class="va">t</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">/</span><span class="fl">5</span>

<span class="co"># ANOVA</span>
<span class="fu"><a href="../reference/get.boundaries.aspend.html">get.boundaries.aspend</a></span><span class="op">(</span>a.func<span class="op">=</span><span class="va">a.func.pocock</span>, a<span class="op">=</span><span class="fl">0.05</span>,
                      rates<span class="op">=</span><span class="va">t</span>, N<span class="op">=</span><span class="fl">1000</span>, n_sims<span class="op">=</span><span class="fl">1000</span>,
                      stat.func<span class="op">=</span><span class="va">p.t.anova</span>,
                      data.generator<span class="op">=</span><span class="va">null.generator</span><span class="op">)</span>
<span class="co">#&gt; [1] 2.508666 2.678084 2.462807 2.446748 2.402187</span>

<span class="co"># ANCOVA</span>
<span class="fu"><a href="../reference/get.boundaries.aspend.html">get.boundaries.aspend</a></span><span class="op">(</span>a.func<span class="op">=</span><span class="va">a.func.pocock</span>, a<span class="op">=</span><span class="fl">0.05</span>,
                      rates<span class="op">=</span><span class="va">t</span>, N<span class="op">=</span><span class="fl">1000</span>, n_sims<span class="op">=</span><span class="fl">1000</span>,
                      stat.func<span class="op">=</span><span class="va">p.t.ancova</span>,
                      data.generator<span class="op">=</span><span class="va">null.generator</span><span class="op">)</span>
<span class="co">#&gt; [1] 2.600277 2.559064 2.494337 2.372499 2.387259</span>

<span class="co"># mismatch ANOVA-ANCOVA</span>
<span class="fu"><a href="../reference/get.boundaries.aspend.html">get.boundaries.aspend</a></span><span class="op">(</span>a.func<span class="op">=</span><span class="va">a.func.pocock</span>, a<span class="op">=</span><span class="fl">0.05</span>,
                      rates<span class="op">=</span><span class="va">t</span>, N<span class="op">=</span><span class="fl">1000</span>, n_sims<span class="op">=</span><span class="fl">1000</span>,
                      stat.func<span class="op">=</span><span class="va">p.t.mismatch</span>,
                      data.generator<span class="op">=</span><span class="va">null.generator</span><span class="op">)</span>
<span class="co">#&gt; [1] 2.469323 2.325102 2.410140 2.392920 2.464564</span></code></pre></div>
<p>The <span class="math inline">\(\alpha\)</span>-spending function that approximates OBF boundaries in a two-sided trial is <span class="math display">\[
\alpha^*(t) = 4(1 - \Phi(\Phi^{-1}(1 - \alpha/4)/\sqrt{t}))
\]</span></p>
<p>where <span class="math inline">\(\Phi\)</span> is the standard normal CDF. Note that when using the <code>get.boundaries.aspend</code> function, we would not transform the test statistic to be on the score statistic scale now because the <span class="math inline">\(\alpha\)</span>-spending function is taking that into account in how it is defined.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># the alpha-spending function</span>
<span class="va">a.func.obf</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">a</span>, <span class="va">t</span><span class="op">)</span> <span class="fl">4</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">pnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">qnorm</a></span><span class="op">(</span><span class="fl">1</span><span class="op">-</span><span class="va">a</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">t</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co"># observed information rates</span>
<span class="va">t</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">/</span><span class="fl">5</span>

<span class="co"># ANOVA</span>
<span class="fu"><a href="../reference/get.boundaries.aspend.html">get.boundaries.aspend</a></span><span class="op">(</span>a.func<span class="op">=</span><span class="va">a.func.obf</span>, a<span class="op">=</span><span class="fl">0.05</span>,
                      rates<span class="op">=</span><span class="va">t</span>, N<span class="op">=</span><span class="fl">1000</span>, n_sims<span class="op">=</span><span class="fl">1000</span>,
                      stat.func<span class="op">=</span><span class="va">p.t.anova</span>,
                      data.generator<span class="op">=</span><span class="va">null.generator</span><span class="op">)</span>
<span class="co">#&gt; [1] 3.447069 3.531668 2.794917 2.391667 2.025142</span>

<span class="co"># ANCOVA</span>
<span class="fu"><a href="../reference/get.boundaries.aspend.html">get.boundaries.aspend</a></span><span class="op">(</span>a.func<span class="op">=</span><span class="va">a.func.obf</span>, a<span class="op">=</span><span class="fl">0.05</span>,
                      rates<span class="op">=</span><span class="va">t</span>, N<span class="op">=</span><span class="fl">1000</span>, n_sims<span class="op">=</span><span class="fl">1000</span>,
                      stat.func<span class="op">=</span><span class="va">p.t.ancova</span>,
                      data.generator<span class="op">=</span><span class="va">null.generator</span><span class="op">)</span>
<span class="co">#&gt; [1] 3.821333 4.159372 2.791973 2.294364 1.954995</span>

<span class="co"># mismatch ANOVA-ANCOVA</span>
<span class="fu"><a href="../reference/get.boundaries.aspend.html">get.boundaries.aspend</a></span><span class="op">(</span>a.func<span class="op">=</span><span class="va">a.func.obf</span>, a<span class="op">=</span><span class="fl">0.05</span>,
                      rates<span class="op">=</span><span class="va">t</span>, N<span class="op">=</span><span class="fl">1000</span>, n_sims<span class="op">=</span><span class="fl">1000</span>,
                      stat.func<span class="op">=</span><span class="va">p.t.mismatch</span>,
                      data.generator<span class="op">=</span><span class="va">null.generator</span><span class="op">)</span>
<span class="co">#&gt; [1] 3.861597 3.297274 2.740595 2.353509 2.147240</span></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by The package maintainer.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
